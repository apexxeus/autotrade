--// SERVICES
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local VirtualInputManager = game:GetService("VirtualInputManager")

--// PLAYER
local LOCAL_PLAYER = Players.LocalPlayer

--// REMOTES
local Remotes = ReplicatedStorage:WaitForChild("Remotes")
local SaveHotbarEvent = Remotes:WaitForChild("SaveHotbarEvent")
local GiftRequestEvent = Remotes:WaitForChild("GiftRequestEvent")
local GiftAcceptEvent = Remotes:WaitForChild("GiftAcceptEvent")
local FrameOpenEvent = Remotes:WaitForChild("FrameOpenEvent")

--// CONSTANTS
local TOOL_NAME = "Rainbow_Swag_Soda__Disco"

--// MICRO GUI (FASTER LOAD)
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "AutoTrade"
screenGui.Parent = LOCAL_PLAYER:WaitForChild("PlayerGui")

-- Main Frame
local main = Instance.new("Frame")
main.Size = UDim2.new(0, 220, 0, 150)
main.Position = UDim2.new(0.5, -110, 0.5, -75)
main.BackgroundColor3 = Color3.fromRGB(20, 20, 30)
main.BorderSizePixel = 1
main.BorderColor3 = Color3.fromRGB(100, 70, 200)
main.Active = true
main.Draggable = true
main.Parent = screenGui

-- Title
local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, 0, 0, 25)
title.BackgroundColor3 = Color3.fromRGB(30, 30, 40)
title.BorderSizePixel = 0
title.Text = "AUTO TRADE SIMPLE"
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.Font = Enum.Font.GothamBold
title.TextSize = 14
title.Parent = main

-- Close
local close = Instance.new("TextButton")
close.Size = UDim2.new(0, 20, 0, 20)
close.Position = UDim2.new(1, -25, 0, 2)
close.BackgroundColor3 = Color3.fromRGB(200, 60, 60)
close.BorderSizePixel = 0
close.Text = "X"
close.TextColor3 = Color3.fromRGB(255, 255, 255)
close.Font = Enum.Font.GothamBold
close.TextSize = 10
close.Parent = title

-- Inputs
local target = Instance.new("TextBox")
target.Size = UDim2.new(0.8, -5, 0, 25)
target.Position = UDim2.new(0.1, 0, 0, 35)
target.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
target.BorderSizePixel = 0
target.Text = ""
target.TextColor3 = Color3.fromRGB(255, 255, 255)
target.Font = Enum.Font.Gotham
target.TextSize = 12
target.PlaceholderText = "Username"
target.Parent = main

local amount = Instance.new("TextBox")
amount.Size = UDim2.new(0.8, -5, 0, 25)
amount.Position = UDim2.new(0.1, 0, 0, 65)
amount.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
amount.BorderSizePixel = 0
amount.Text = ""
amount.TextColor3 = Color3.fromRGB(255, 255, 255)
amount.Font = Enum.Font.Gotham
amount.TextSize = 12
amount.PlaceholderText = "Amount"
amount.Parent = main

-- Control Buttons
local startBtn = Instance.new("TextButton")
startBtn.Size = UDim2.new(0.8, -5, 0, 25)
startBtn.Position = UDim2.new(0.1, 0, 0, 100)
startBtn.BackgroundColor3 = Color3.fromRGB(60, 180, 80)
startBtn.BorderSizePixel = 0
startBtn.Text = "START TRADE"
startBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
startBtn.Font = Enum.Font.GothamBold
startBtn.TextSize = 13
startBtn.Parent = main

local stopBtn = Instance.new("TextButton")
stopBtn.Size = UDim2.new(0.8, -5, 0, 25)
stopBtn.Position = UDim2.new(0.1, 0, 0, 130)
stopBtn.BackgroundColor3 = Color3.fromRGB(180, 60, 60)
stopBtn.BorderSizePixel = 0
stopBtn.Text = "STOP TRADE"
stopBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
stopBtn.Font = Enum.Font.GothamBold
stopBtn.TextSize = 13
stopBtn.Parent = main

-- Status
local status = Instance.new("TextLabel")
status.Size = UDim2.new(1, -20, 0, 20)
status.Position = UDim2.new(0, 10, 1, -25)
status.BackgroundTransparency = 1
status.Text = "Ready - Enter username & amount"
status.TextColor3 = Color3.fromRGB(150, 255, 150)
status.Font = Enum.Font.Gotham
status.TextSize = 12
status.Parent = main

--// VARIABLES
local isRunning = false
local autoAcceptRunning = false
local antiAFKRunning = false
local giftThread = nil
local autoAcceptThread = nil
local antiAFKThread = nil
local sentCount = 0

--// SIMPLE FUNCTIONS
local function updateStatus(text, color)
    status.Text = text
    status.TextColor3 = color
end

local function findTool()
    local backpack = LOCAL_PLAYER.Backpack
    if backpack then
        for _, item in ipairs(backpack:GetChildren()) do
            if item.Name == TOOL_NAME then
                return item
            end
        end
    end
    
    local character = LOCAL_PLAYER.Character
    if character then
        for _, item in ipairs(character:GetChildren()) do
            if item.Name == TOOL_NAME then
                return item
            end
        end
    end
    
    return nil
end

--// AUTO TRADE FUNCTION
local function startAutoTrade()
    if isRunning then return end
    
    local targetName = target.Text
    local amt = tonumber(amount.Text)
    
    if targetName == "" or not amt or amt <= 0 then
        updateStatus("Invalid input", Color3.fromRGB(255, 100, 100))
        return
    end
    
    local targetPlayer = Players:FindFirstChild(targetName)
    if not targetPlayer then
        updateStatus("Player not found", Color3.fromRGB(255, 100, 100))
        return
    end
    
    -- Save hotbar
    SaveHotbarEvent:FireServer(
        {["1"] = "\255", ["2"] = "Slap Hand", ["3"] = "Rainbow_Swag_Soda__Disco"},
        {}
    )
    
    isRunning = true
    sentCount = 0
    startBtn.BackgroundColor3 = Color3.fromRGB(40, 140, 60)
    updateStatus("Trading...", Color3.fromRGB(255, 220, 100))
    
    giftThread = task.spawn(function()
        while isRunning and sentCount < amt do
            local tool = findTool()
            if tool then
                GiftRequestEvent:FireServer(targetPlayer, tool)
                sentCount += 1
                
                if sentCount % 10 == 0 then
                    updateStatus("Sent: " .. sentCount, Color3.fromRGB(255, 220, 100))
                end
                
                -- 1 second delay
                task.wait(1)
            else
                updateStatus("No tool found", Color3.fromRGB(255, 100, 100))
                break
            end
        end
        
        isRunning = false
        startBtn.BackgroundColor3 = Color3.fromRGB(60, 180, 80)
        updateStatus("Done: " .. sentCount, Color3.fromRGB(100, 255, 100))
    end)
end

local function stopAutoTrade()
    isRunning = false
    startBtn.BackgroundColor3 = Color3.fromRGB(60, 180, 80)
    updateStatus("Stopped", Color3.fromRGB(255, 150, 100))
    
    if giftThread then
        task.cancel(giftThread)
        giftThread = nil
    end
end

--// AUTO ACCEPT FUNCTION (SIMPLIFIED)
local function startAutoAccept()
    autoAcceptRunning = true
    updateStatus("Auto-Accept ON", Color3.fromRGB(100, 200, 255))
    
    autoAcceptThread = task.spawn(function()
        while autoAcceptRunning do
            FrameOpenEvent:FireServer(true)
            GiftAcceptEvent:FireServer()
            FrameOpenEvent:FireServer(false)
            task.wait(1)  -- Check every 1 second
        end
    end)
end

--// ANTI-AFK FUNCTION
local function startAntiAFK()
    antiAFKRunning = true
    updateStatus("Anti-AFK ON", Color3.fromRGB(100, 255, 100))
    
    antiAFKThread = task.spawn(function()
        while antiAFKRunning do
            local character = LOCAL_PLAYER.Character
            if character then
                local humanoid = character:FindFirstChildOfClass("Humanoid")
                if humanoid then
                    humanoid.Jump = true
                end
            end
            
            VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.Space, false, game)
            task.wait(0.05)
            VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.Space, false, game)
            
            task.wait(20)  -- Perform action every 20 seconds
        end
    end)
end

--// BUTTON EVENTS
startBtn.MouseButton1Click:Connect(startAutoTrade)
stopBtn.MouseButton1Click:Connect(stopAutoTrade)

-- Toggle buttons on title bar for auto-accept and anti-afk
local autoAcceptBtn = Instance.new("TextButton")
autoAcceptBtn.Size = UDim2.new(0, 25, 0, 25)
autoAcceptBtn.Position = UDim2.new(1, -55, 0, 2)
autoAcceptBtn.BackgroundColor3 = Color3.fromRGB(80, 160, 220)
autoAcceptBtn.BorderSizePixel = 0
autoAcceptBtn.Text = "A"
autoAcceptBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
autoAcceptBtn.Font = Enum.Font.GothamBold
autoAcceptBtn.TextSize = 12
autoAcceptBtn.Parent = title

local antiAFKBtn = Instance.new("TextButton")
antiAFKBtn.Size = UDim2.new(0, 25, 0, 25)
antiAFKBtn.Position = UDim2.new(1, -85, 0, 2)
antiAFKBtn.BackgroundColor3 = Color3.fromRGB(80, 180, 80)
antiAFKBtn.BorderSizePixel = 0
antiAFKBtn.Text = "F"
antiAFKBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
antiAFKBtn.Font = Enum.Font.GothamBold
antiAFKBtn.TextSize = 12
antiAFKBtn.Parent = title

autoAcceptBtn.MouseButton1Click:Connect(function()
    if autoAcceptRunning then
        autoAcceptRunning = false
        autoAcceptBtn.BackgroundColor3 = Color3.fromRGB(80, 160, 220)
        updateStatus("Auto-Accept OFF", Color3.fromRGB(255, 150, 100))
        
        if autoAcceptThread then
            task.cancel(autoAcceptThread)
            autoAcceptThread = nil
        end
    else
        startAutoAccept()
        autoAcceptBtn.BackgroundColor3 = Color3.fromRGB(60, 140, 200)
    end
end)

antiAFKBtn.MouseButton1Click:Connect(function()
    if antiAFKRunning then
        antiAFKRunning = false
        antiAFKBtn.BackgroundColor3 = Color3.fromRGB(80, 180, 80)
        updateStatus("Anti-AFK OFF", Color3.fromRGB(255, 150, 100))
        
        if antiAFKThread then
            task.cancel(antiAFKThread)
            antiAFKThread = nil
        end
    else
        startAntiAFK()
        antiAFKBtn.BackgroundColor3 = Color3.fromRGB(60, 160, 70)
    end
end)

close.MouseButton1Click:Connect(function()
    stopAutoTrade()
    
    if autoAcceptRunning then
        autoAcceptRunning = false
        if autoAcceptThread then task.cancel(autoAcceptThread) end
    end
    
    if antiAFKRunning then
        antiAFKRunning = false
        if antiAFKThread then task.cancel(antiAFKThread) end
    end
    
    screenGui:Destroy()
end)

--// ROBLOX IDLE DETECTION HOOK
LOCAL_PLAYER.Idled:Connect(function()
    if antiAFKRunning then
        VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.Space, false, game)
        task.wait(0.1)
        VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.Space, false, game)
        updateStatus("Idle prevention", Color3.fromRGB(100, 255, 100))
    end
end)

print("[AUTO TRADE] Simple version loaded")
print("[FEATURES] Auto Trade + Auto Accept + Anti-AFK")
print("[DELAY] 1 second between trades")
print("[CONTROLS] Start/Stop trade buttons + Auto-accept/Anti-AFK toggles")

-- Initial tool check
task.spawn(function()
    task.wait(2)
    local tool = findTool()
    if tool then
        updateStatus("Ready - Tool found", Color3.fromRGB(150, 255, 150))
    else
        updateStatus("Tool not found!", Color3.fromRGB(255, 100, 100))
    end
end)
